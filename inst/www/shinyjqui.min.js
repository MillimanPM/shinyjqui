(shinyjqui=function(){var shinyMode=void 0!==window.Shiny&&!!window.Shiny.outputBindings,getInputContainer=function(e){if(!$(e).hasClass("shiny-bound-input")||$(e).hasClass("btn"))return e;var t=$(e).closest(".shiny-input-container");return t.length?t.get(0):e},regShinyInput=function(e,t,a){$.each(a,function(a,i){var n=t+"_"+a;$.each(i,function(t,a){$(e).on(t,function(e,t){if($(e.target).hasClass("shinyjqui")&&("resize"!=e.type||void 0!==t)){var i=a(e,t);Shiny.onInputChange(n,i)}})})})},handleShinyInput=function(e,t,a){if(!shinyMode)return null;var i=shinyjqui.getId(e);if(i){var n=Object.assign({},a);if(t&&t.hasOwnProperty("shiny")){var r=Object.keys(n);$.each(r,function(e,a){$.inArray(a.replace(/:.+/,""),Object.keys(t.shiny))>=0&&delete n[a]}),$.extend(n,t.shiny),delete t.shiny}regShinyInput(e,i,n)}},evaluateJSExpressions=function(opt,idx){$.each(idx,function(key,value){!0===value&&opt[key]?opt[key]=eval("("+opt[key]+")"):"object"==typeof value&&evaluateJSExpressions(opt[key],value)})},evalJS=function(e){var t=e._js_idx;return t&&"object"==typeof t&&evaluateJSExpressions(e,t),e},handleServerMsg=function(e){e=evalJS(e);var t=$(e.ui);if(!t){console.warn("The selector didn't match any element. Operation abort.");return}return t=t.map(function(e,t){return t=getInputContainer(t),t=addWrapper(t),(t=getWrapper(t)).classList.add("shinyjqui"),t}),e.debug&&(console.log("==================="),console.log("ELEMENTS: "),console.log(t),console.log("MSG: "),console.log(e),console.log("===================")),{elements:t,type:e.type,func:e.func,operation:e.operation,options:e.options}},isHidden=function(e){return null!==e&&0===e.offsetWidth&&0===e.offsetHeight&&("none"===getStyle(e,"display")||isHidden(e.parentNode))},addJquiData=function(e){var t={draggable:{save:{}},droppable:{save:{}},resizable:{save:{}},selectable:{save:{}},sortable:{save:{}}};$(e).data("shinyjqui")||$(e).data("shinyjqui",t)},removeJquiData=function(e){var t=$(e);!(!t.hasClass("jqui-wrapper")||t.hasClass("ui-draggable")||t.hasClass("ui-droppable")||t.hasClass("ui-selectable")||t.hasClass("ui-sortable")||t.hasClass("ui-resizable"))&&t.removeData("shinyjqui")},addWrapper=function(e){if($(e).parent().hasClass("jqui-wrapper"))return e;if("htmlwidget_container"==$(e).parent().attr("id"))return $(e).parent().get(0);var t=/action-button|html-widget-output|shiny-.+?-output|html-widget-static-bound/;if($(e).parent().hasClass("shiny-spinner-output-container"))return t.test($(e).attr("class"))?($(e).outerWidth("100%").outerHeight("100%").css({top:"0px",left:"0px"}),$(e).parent().get(0)):e;if($(e).hasClass("shiny-spinner-output-container"))return $(e).children("div[class^=shiny-][class$=-output]").outerWidth("100%").outerHeight("100%").css({top:"0px",left:"0px"}),e;if(!t.test($(e).attr("class")))return e;var a=$("<div></div>").outerWidth($(e).outerWidth()?$(e).outerWidth():"100%").outerHeight($(e).outerHeight()?$(e).outerHeight():"100%").css($(e).css(["top","left"])).addClass("jqui-wrapper");return $(e).wrap(a).outerWidth("100%").outerHeight("100%").css({top:"0px",left:"0px"}).parent().get(0)},removeWrapper=function(e){var t=$(e);!(!t.hasClass("jqui-wrapper")||t.hasClass("ui-draggable")||t.hasClass("ui-droppable")||t.hasClass("ui-selectable")||t.hasClass("ui-sortable")||t.hasClass("ui-resizable"))&&(t.children(".shiny-bound-output").outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).css(t.css(["top","left"])).insertAfter(t),t.remove())},getWrapper=function(e){return $(e).parent().hasClass("jqui-wrapper")&&(e=$(e).parent().get(0)),e},addIndex=function(e){var t=$(e),a=shinyjqui.getId(e);if(t.hasClass("ui-sortable")&&a&&(t.find(".ui-sortable-handle").attr("jqui_sortable_idx",function(e,t){return a+"__"+(e+1)}),t.trigger("sortcreate")),t.hasClass("ui-draggable")&&t.draggable("option","connectToSortable")&&!t.is("[jqui_sortable_idx]")){var i=$(".ui-draggable").filter("[jqui_sortable_idx]").length;t.attr("jqui_sortable_idx",i+1)}t.hasClass("ui-selectable")&&a&&(t.find(".ui-selectee").attr("jqui_selectable_idx",function(e,t){return a+"__"+(e+1)}),t.trigger("selectablecreate"))},removeIndex=function(e){var t=$(e);t.hasClass("ui-selectable")||t.find(".ui-selectee").removeAttr("jqui_seletable_idx"),t.hasClass("ui-sortable")||t.find(".ui-sortable-handle").removeAttr("jqui_sortable_idx"),t.hasClass("ui-draggable")||t.removeAttr("jqui_sortable_idx")},interaction_settings={draggable:{getState:function(e){return $(e).offset()},setState:function(e,t){var a=$(e),i=new $.Event("mousedown",{pageX:a.offset().left,pageY:a.offset().top}),n=new $.Event("mouseup",{pageX:t.left,pageY:t.top});a.data("uiDraggable")._mouseStart(i),a.data("uiDraggable")._mouseDrag(n),a.data("uiDraggable")._mouseStop(n)},shiny:{_shinyjquiBookmarkState__draggable:{"dragcreate dragstop":function(e,t){return interaction_settings.draggable.getState(e.target)}},position:{"dragcreate drag dragstop":function(e,t){return $(e.target).position()}},is_dragging:{"dragcreate dragstop":function(e,t){return!1},dragstart:function(e,t){return!0}}}},droppable:{getState:function(e){},setState:function(e,t){},shiny:{over:{dropcreate:function(e,t){return[]},dropover:function(e,t){return shinyjqui.getId(t.draggable.get(0))}},drop:{dropcreate:function(e,t){return[]},drop:function(e,t){return shinyjqui.getId(t.draggable.get(0))}},out:{dropcreate:function(e,t){return[]},dropout:function(e,t){return shinyjqui.getId(t.draggable.get(0))}},dragging:{dropcreate:function(e,t){return[]},dropactivate:function(e,t){return shinyjqui.getId(t.draggable.get(0))},dropdeactivate:function(e,t){return[]}},dropped:{dropcreate:function(e,t){return $(e.target).data("shinyjqui_droppedIds",[]),[]},drop:function(e,t){var a=$(e.target).data("shinyjqui_droppedIds"),i=shinyjqui.getId(t.draggable.get(0));return -1==$.inArray(i,a)&&a.push(i),$(e.target).data("shinyjqui_droppedIds",a),a},dropout:function(e,t){var a=$(e.target).data("shinyjqui_droppedIds"),i=shinyjqui.getId(t.draggable.get(0));return a.splice($.inArray(i,a),1),$(e.target).data("shinyjqui_droppedIds",a),a}}}},resizable:{getState:function(e){return{width:$(e).width(),height:$(e).height()}},setState:function(e,t){var a=$(e),i=new $.Event("mousedown",{pageX:0,pageY:0}),n=new $.Event("mouseup",{pageX:t.width-a.width(),pageY:t.height-a.height()});a.data("uiResizable").axis="se",a.data("uiResizable")._mouseStart(i),a.data("uiResizable")._mouseDrag(n),a.data("uiResizable")._mouseStop(n)},shiny:{_shinyjquiBookmarkState__resizable:{"resizecreate resizestop":function(e,t){return interaction_settings.resizable.getState(e.target)}},size:{"resize resizestop":function(e,t){return{width:t.size.width,height:t.size.height}},resizecreate:function(e,t){return{width:$(e.target).width(),height:$(e.target).height()}}},is_resizing:{"resizecreate resizestop":function(e,t){return!1},resizestart:function(e,t){return!0}}}},selectable:{getState:function(e){var t=$(e).find(".ui-selected"),a=t.map(function(e,t){return $(t).attr("jqui_selectable_idx")}).get();return{selected:t,index:a}},setState:function(e,t){var a,i=$(e),n=i.selectable("option","classes.ui-selected");n=n?"ui-selected "+n:"ui-selected",t.selected instanceof jQuery?a=t.selected:(Array.isArray(t.index)||(t.index=Array(t.index)),a=$(t.index).map(function(e,t){return $("[jqui_selectable_idx="+t+"]").get(0)})),i.find(".ui-selected").not(a).removeClass(n).addClass("ui-unselecting"),a.not(".ui-selected").addClass("ui-selecting"),i.data("uiSelectable")._mouseStop(null)},shiny:{_shinyjquiBookmarkState__selectable:{"selectablecreate selectablestop":function(e,t){var a=interaction_settings.selectable.getState(e.target);return a.selected="",a}},"selected:shinyjqui.df":{"selectablecreate selectablestop":function(e,t){var a=$(e.target).find(".ui-selected"),i=a.map(function(e,t){return t.innerText?t.innerText:""}).get();return{id:a.map(function(e,t){return shinyjqui.getId(t)}).get(),text:i}}},is_selecting:{"selectablecreate selectablestop":function(e,t){return!1},selectablestart:function(e,t){return!0}}}},sortable:{getState:function(e){var t=$(e).find(".ui-sortable-handle,.ui-draggable").clone(),a=t.map(function(e,t){return $(t).attr("jqui_sortable_idx")}).get();return{items:t,index:a}},setState:function(e,t){var a=$(e),i=a.find(".ui-sortable-handle,.ui-draggable"),n=i.length?i.parent():a;if(t.items instanceof jQuery)i.remove(),n.append(t.items);else{Array.isArray(t.index)||(t.index=Array(t.index));var r,s=i.clone(),o=$("body").data("shinyjquiTemp");o?$("body").data("shinyjquiTemp",o.add(s)):$("body").data("shinyjquiTemp",s),i.remove(),$.each(t.index,function(e,t){var a=$("body").data("shinyjquiTemp").filter("[jqui_sortable_idx="+t+"]").first();return 1==a.length?(n.append(a),!0):0==(a=$("[jqui_sortable_idx="+t+"]").first()).length?(console.warn("Can't find item [jqui_sortable_idx="+t+"] durining bookmarking restoration!"),!0):void(a.hasClass("ui-draggable")?a.clone().appendTo(n):(r=a.closest(".ui-sortable"),a.appendTo(n),r.trigger("sortupdate")))})}a.trigger("sortupdate")},shiny:{_shinyjquiBookmarkState__sortable:{"sortcreate sortupdate":function(e,t){var a=interaction_settings.sortable.getState(e.target);return a.items="",a}},"order:shinyjqui.df":{"sortcreate sortupdate":function(e,t){var a=$(e.target).sortable("option","items"),i=$(e.target).find(a),n=i.map(function(e,t){return t.innerText?t.innerText:""}).get();return{id:i.map(function(e,t){return shinyjqui.getId(t)}).get(),text:n}}}}}},interaction={enable:function(e,t,a){handleShinyInput(e,a,interaction_settings[t].shiny),$(e)[t](a),$(e)[t]("enable"),addJquiData(e),addIndex(e)},disable:function(e,t,a){handleShinyInput(e,a,interaction_settings[t].shiny),$(e)[t](a),$(e)[t]("disable")},destroy:function(e,t,a){var i=$(e);if(!i.hasClass("ui-"+t)){console.warn("Interaction not initiated. Operation abort.");return}i[t]("destroy"),removeJquiData(e),removeWrapper(e),removeIndex(e),i.removeClass("shinyjqui")},save:function(e,t,a){var i=$(e);handleShinyInput(e,a,interaction_settings[t].shiny),i[t](a),i.data("shinyjqui")[t].save={option:i[t]("option"),state:interaction_settings[t].getState(e)}},load:function(e,t,a){var i=$(e);i.hasClass("ui-"+t)||(console.warn("Interaction not initiated. Will run initiation first."),i[t]());var n=a||i.data("shinyjqui")[t].save;if(!n){console.warn("Nothing can be load. Operation abort.");return}n.option&&i[t]("option",n.option),n.state&&interaction_settings[t].setState(e,n.state)}};return{getId:function(e){var t=$(e).attr("id");return!t&&$(e).hasClass("tabbable")&&(t=$(e).find(".shiny-bound-input").attr("id")),t||(t=$(e).closest(".shiny-input-container").find(".shiny-bound-input").attr("id")),t||(t=$(e).closest(".jqui-wrapper").find(".shiny-bound-output").attr("id")),t||(t=$(e).closest(".shiny-bound-output").attr("id")),t||""},msgCallback:function(e){if(e=handleServerMsg(e)){var t=e.elements,a=e.type,i=e.operation,n=e.func,r=e.options;"interaction"===a?t.each(function(e,t){interaction[i](t,n,r)}):"effect"===a?t[n](effect=r.effect,options=r.options,duration=r.duration,complete=r.complete):"class"===a?"add"===n||"remove"===n?t[n+"Class"](r.className,r):"switch"===n&&t.switchClass(r.removeClassName,r.addClassName,r):"other"===a&&"position"===n&&t.position(r)}},init:function(){shinyMode&&Shiny.addCustomMessageHandler("shinyjqui",shinyjqui.msgCallback)}}}()).init();
